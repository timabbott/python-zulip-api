language: python
sudo: required
python:
  - "3.4"
  - "3.5"
  - "3.6"
env:
  matrix:
    - TEST_SUITE=test-main
  global:
    - BOTO_CONFIG=/tmp/nowhere
matrix:
  include:
  - python: "2.7"
    env: TEST_SUITE=test-py2-legacy-support
  - python: "3.6"
    env: TEST_SUITE=test-static-analysis
  - python: "3.6"
    sudo: required
    env: TEST_SUITE=backend
    script:
    - echo $TRAVIS_PULL_REQUEST_BRANCH
    - echo $TRAVIS_PULL_REQUEST_SLUG
    - echo $TRAVIS_PULL_REQUEST
    - cd
    - git clone https://github.com/zulip/zulip.git
    - cd zulip
    - $TRAVIS_BUILD_DIR/tools/test-backend
    addons:
      postgresql: "9.3"
install:
  - sudo rm -vf /etc/apt/sources.list.d/*
  - sudo apt-get update
  - tools/provision --force
  - source zulip-api-py*-venv/bin/activate
script:
  - tools/$TEST_SUITE
after_success:
  - pip install codecov
  - codecov
